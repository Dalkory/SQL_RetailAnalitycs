CREATE TABLE IF NOT EXISTS personal_information
(
    customer_id            SERIAL PRIMARY KEY,
    customer_name          VARCHAR,
    customer_surname       VARCHAR,
    customer_primary_email VARCHAR,
    customer_primary_phone VARCHAR,
    CONSTRAINT ch_customer_primary_email CHECK (customer_primary_email ~ '^[^ ]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,}$'),
    CONSTRAINT ch_customer_primary_phone CHECK (customer_primary_phone ~ '^\+7\d{10}$'),
    CONSTRAINT ch_customer_customer_name CHECK (customer_name ~ '(^[A-Z][a-z\-\ ]*$|^[А-Я][а-я\-\ ]*$)'),
    CONSTRAINT ch_customer_customer_surname CHECK (customer_surname ~ '(^[A-Z][a-z\-\ ]*$|^[А-Я][а-я\-\ ]*$)')
);

CREATE TABLE IF NOT EXISTS cards
(
    customer_card_id SERIAL PRIMARY KEY unique,
    customer_id      INT,
    CONSTRAINT fk_cards_customer_id FOREIGN KEY (customer_id) REFERENCES personal_information (customer_id)
);

CREATE TABLE IF NOT EXISTS sku_group
(
    group_id   SERIAL PRIMARY KEY,
    group_name VARCHAR,
    CONSTRAINT ch_sku_group_group_name CHECK (group_name ~ '^[^ ]*$')
);

CREATE TABLE IF NOT EXISTS product_grid
(
    sku_id   SERIAL PRIMARY KEY,
    sku_name VARCHAR,
    group_id INT,
    CONSTRAINT fk_product_grid_group_id FOREIGN KEY (group_id) REFERENCES sku_group (group_id)
);

CREATE TABLE IF NOT EXISTS stores
(
    transaction_store_id INT,
    sku_id               INT,
    sku_purchase_price   NUMERIC,
    sku_retail_price     NUMERIC,
    CONSTRAINT fk_stores_sku_id FOREIGN KEY (sku_id) REFERENCES product_grid (sku_id)
);

CREATE TABLE IF NOT EXISTS transactions
(
    transaction_id       SERIAL PRIMARY KEY,
    customer_card_id     INT,
    transaction_summ     NUMERIC,
    transaction_datetime VARCHAR,
    transaction_store_id INT,
    CONSTRAINT fk_transactions_customer_card_id FOREIGN KEY (customer_card_id) REFERENCES cards (customer_card_id),
    CONSTRAINT ch_transactions_transaction_datetime CHECK (
                transaction_datetime ~ '^\d{2}\.\d{2}\.\d{4} \d{1,2}:\d{2}:\d{2}$'
            AND TO_DATE(transaction_datetime, 'DD.MM.YYYY HH24:MI:SS') IS NOT NULL
        )
);

CREATE TABLE IF NOT EXISTS checks
(
    transaction_id INT,
    sku_id         INT,
    sku_amount     NUMERIC,
    sku_summ       NUMERIC,
    sku_summ_paid  NUMERIC,
    sku_discount   NUMERIC,
    CONSTRAINT fk_checks_transaction_id FOREIGN KEY (transaction_id) REFERENCES transactions (transaction_id),
    CONSTRAINT fk_checks_sku_id FOREIGN KEY (sku_id) REFERENCES product_grid (sku_id)
);

CREATE TABLE IF NOT EXISTS date_of_analysis_formation
(
    analysis_formation VARCHAR,
    CONSTRAINT ch_analysis_formation CHECK (
                analysis_formation ~ '^\d{2}\.\d{2}\.\d{4} \d{1,2}:\d{2}:\d{2}$'
            AND TO_DATE(analysis_formation, 'DD.MM.YYYY HH24:MI:SS') IS NOT NULL
        )
);

INSERT INTO personal_information VALUES
    ('1','Евгений','Варенников','hdfavorgbdb700@gmail.com','+74910382990'),
    ('2','Лев','Цирюльников','hihaf439jokerfhhb71@ya.ru','+79005457407'),
    ('3','Алексей','Варенников','c5moto1@ya.ru','+78510562549'),
    ('4','Александр','Палкин','dddca0jokerifia@gmail.com','+74957609115'),
    ('5','Лев','Шменин','634mexicaneb01@gmail.com','+79003272088'),
    ('6','Войцех','Палкин','68lodochnikecafa@ya.ru','+79000680819'),
    ('7','Станислав','Варенников','b06kv30@ya.ru','+74828720001'),
    ('8','Евгений','Сидоров','c366tigerfbhgg@gmail.com','+74821842954'),
    ('9','Александр','Айтматов','zeder@gmail.com','+79006510152'),
    ('10','Войцех','Иванов','biia762motoea29@mail.ru','+74825256269'),
    ('11','Станислав','Сидоров','92camperid155@mail.ru','+78510869844'),
    ('12','Илья','Петраускас','gaba881lodochnikecgfe@mail.ru','+79166238770'),
    ('13','Алексей','Матюков','eha301hackerdcaa36@gmail.com','+74954319120'),
    ('14','Кирилл','Петров','gdb3hacker5@ya.ru','+74820674344'),
    ('15','Олег','Тимчук','edgjokerfighf38@ya.ru','+74958766798'),
    ('16','Ян','Кириллов','ifgbd5tigerd3@ya.ru','+79635436306'),
    ('17','Войцех','Лосев','b098konigib9@gmail.com','+79230790022'),
    ('18','Ахмат','Кириллов','dab70tigerd08@mail.ru','+79639411295'),
    ('19','Лев','Матюков','bffi101favorbefag@ya.ru','+79631913510'),
    ('20','Василий','Кириллов','facgtigergd018@mail.ru','+78512083963');

INSERT INTO cards(customer_card_id, customer_id) VALUES
    ('1','19'),
    ('2','6'),
    ('3','1'),
    ('4','5'),
    ('5','5'),
    ('6','6'),
    ('7','14'),
    ('8','5'),
    ('9','20'),
    ('10','9'),
    ('11','10'),
    ('12','11'),
    ('13','4'),
    ('14','3'),
    ('15','6'),
    ('16','15'),
    ('17','3'),
    ('18','20'),
    ('19','14'),
    ('20','6'),
    ('21','19'),
    ('22','1');

INSERT INTO sku_group (group_id, group_name)
 VALUES
    ('1','Чипсы'),
    ('2','Колбаса'),
    ('3','Ром'),
    ('4','Автомобили'),
    ('5','Зарядки'),
    ('6','Сухари'),
    ('7','Бумага'),
    ('8','Ручки'),
    ('9','Карандаши'),
    ('10','Сыр'),
    ('11','Доски'),
    ('12','Отвертки'),
    ('13','Зефир'),
    ('14','Мармелад'),
    ('15','Пиво'),
    ('16','Майонез'),
    ('17','Пианино'),
    ('18','Авокадо'),
    ('19','Носки'),
    ('20','Молоко');

INSERT INTO product_grid (sku_id, sku_name, group_id)
 VALUES
    ('1','Kerton Бензин АИ-95 Поездка','4'),
    ('2','Heipz GmbH Рубашка хб Ревалон','5'),
    ('3','Leizein Квас Red Line','2'),
    ('4','ВНИИ Агропром Лимонад Байкал Red Line','6'),
    ('5','ООО Леторг Яблоки Антоновка Ревалон','5'),
    ('6','Kerton Яблоки Антоновка Поездка','2'),
    ('7','Kerton Бензин АИ-95 Поездка','7'),
    ('8','ООО Леторг Анальгин Поездка','8'),
    ('9','Heipz GmbH Семечки Перископ','3'),
    ('10','Kerton Бензин АИ-95 Shadow','5'),
    ('11','Uzuma-Kolberg Ручка шариковая James Bondski','5'),
    ('12','Leizein Рубашка хб Ромашка','5'),
    ('13','Heipz GmbH Конфеты шоколадные Ревалон','9'),
    ('14','Kerton Сталь Ревалон','3'),
    ('15','ВНИИ Агропром Апельсины Red Line','1'),
    ('16','Heipz GmbH Бензин АИ-95 James Bondski','2'),
    ('17','Kerton Яблоки Антоновка Ромашка','2'),
    ('18','Heipz GmbH Ручка шариковая Ромашка','1'),
    ('19','Heipz GmbH Сталь Shadow','6'),
    ('20','Leizein Доска деревянная Перископ','6');

INSERT INTO stores(transaction_store_id, sku_id, sku_purchase_price, sku_retail_price)
 VALUES
    ('1','2','78.0071743954938','104.882359988255'),
    ('1','15','37.1122526568883','70.9353411966504'),
    ('1','3','41.3234384410658','55.9188140878772'),
    ('2','15','17.3098081747581','26.4077416772713'),
    ('2','1','451.666335250561','856.58455647295'),
    ('2','2','202.180201730775','322.748685452148'),
    ('2','3','34.7498347888467','37.1024073275499'),
    ('3','14','499.694510699108','536.918378299382'),
    ('4','2','26.9790156544088','37.1520945872013'),
    ('4','18','167.562271226925','317.875939636211'),
    ('4','7','14.8149212961155','23.6089408170489');

INSERT INTO transactions(transaction_id, customer_card_id, transaction_summ, transaction_datetime, transaction_store_id) VALUES
    ('1','3','336.3206767','23.08.2018 0:47:37','1'),
    ('2','2','89.51519966','22.09.2019 12:32:00','2'),
    ('3','17','294.7881466','25.09.2019 9:52:52','1'),
    ('4','13','79.97275934','15.09.2021 15:52:53','2'),
    ('5','8','95.33623781','31.12.2018 12:11:05','1'),
    ('6','1','222.4849104','22.02.2021 23:13:32','4'),
    ('7','8','809.8487556','21.02.2020 12:31:42','1'),
    ('8','13','514.9179273','16.06.2022 21:01:05','4'),
    ('9','9','329.3056619','09.10.2021 5:25:51','1'),
    ('10','13','3970.088708','14.03.2019 16:01:34','2'),
    ('11','11','316.1061682','04.02.2022 17:53:41','4'),
    ('12','20','49.60868804','18.08.2020 11:06:54','2'),
    ('13','19','1328.011529','18.07.2022 7:52:02','3'),
    ('14','12','405.6983802','16.02.2019 11:12:14','4'),
    ('15','4','4092.819874','20.02.2020 13:47:53','3'),
    ('16','9','952.7096335','07.10.2019 5:26:39','3'),
    ('17','15','181.4474813','09.07.2018 0:43:40','2'),
    ('18','6','2054.194912','16.11.2019 10:25:03','2'),
    ('19','11','713.0447141','13.07.2018 0:51:02','3'),
    ('20','6','777.0957463','10.02.2021 16:44:04','3'),
    ('21','9','1029.846352','20.10.2018 8:36:04','3'),
    ('22','15','2376.055803','16.01.2019 4:40:16','3'),
    ('23','9','75.17610456','27.07.2020 21:35:45','4'),
    ('24','21','220.0723485','28.04.2020 23:00:56','2'),
    ('25','4','419.1212654','30.08.2019 19:28:09','2'),
    ('26','19','242.4499511','01.08.2020 16:13:41','1'),
    ('27','8','52.33200194','05.04.2021 21:57:33','2'),
    ('28','4','618.4757122','21.09.2018 8:52:33','1'),
    ('29','13','70.16898143','03.07.2018 2:22:48','4'),
    ('30','15','126.6433364','12.02.2019 16:21:17','2'),
    ('31','6','274.0624596','28.07.2019 22:51:27','1'),
    ('32','20','2314.329341','09.03.2019 22:40:00','3'),
    ('33','14','468.220868','20.08.2022 7:31:15','4'),
    ('34','1','906.8787372','22.11.2019 13:50:00','1'),
    ('35','16','68.7860833','30.07.2018 23:37:18','2'),
    ('36','15','610.5591841','22.03.2021 6:34:02','4'),
    ('37','4','182.0543675','22.02.2020 11:20:37','1'),
    ('38','19','91.93566531','23.06.2020 2:52:33','4'),
    ('39','6','566.0471594','27.08.2020 7:54:55','4'),
    ('40','22','886.5508571','01.11.2021 11:19:00','4'),
    ('41','12','3692.282832','09.02.2020 14:00:31','3'),
    ('42','11','263.3015432','25.12.2020 16:19:45','1'),
    ('43','2','1606.931162','19.10.2018 18:06:55','2'),
    ('44','10','116.185828','26.05.2022 1:55:26','1'),
    ('45','6','306.0922312','07.03.2021 5:39:52','1'),
    ('46','3','933.7694265','04.12.2021 15:25:03','4'),
    ('47','18','1976.360173','19.06.2021 7:17:30','3'),
    ('48','4','114.8740228','19.10.2018 0:29:39','4'),
    ('49','21','1303.659689','17.12.2021 13:54:29','4'),
    ('50','12','26.55947893','13.09.2019 21:35:17','4'),
    ('51','6','102.245738','19.09.2018 16:05:48','4'),
    ('52','7','45.77943588','02.05.2019 0:46:33','4'),
    ('53','10','3216.082215','28.03.2018 14:26:47','3'),
    ('54','21','34.75745837','27.06.2021 13:03:53','2'),
    ('55','4','29.21030625','05.08.2021 10:54:01','4'),
    ('56','4','83.24444627','25.04.2022 12:50:21','4'),
    ('57','5','1377.108233','24.07.2022 9:24:33','4'),
    ('58','1','201.6083027','03.12.2021 17:32:22','4'),
    ('59','3','45.23478835','19.10.2020 23:19:19','2'),
    ('60','17','364.968166','10.01.2021 21:55:05','1'),
    ('61','5','174.0106691','16.04.2020 11:54:10','4'),
    ('62','9','200.0499457','14.04.2022 7:25:25','2'),
    ('63','4','683.597179','28.07.2020 10:28:42','3'),
    ('64','22','84.83145801','23.04.2018 14:24:16','2'),
    ('65','12','1315.047114','30.07.2020 0:13:57','4'),
    ('66','9','56.4978694','16.09.2020 19:23:48','2'),
    ('67','3','1049.065299','08.06.2019 2:01:36','3'),
    ('68','8','243.9607986','27.06.2021 14:12:49','1'),
    ('69','2','48.35131315','15.03.2020 3:51:33','2'),
    ('70','18','171.7317856','30.07.2020 21:30:13','2'),
    ('71','6','120.2202312','29.01.2021 2:33:29','4'),
    ('72','22','79.2930991','03.03.2022 5:52:10','1'),
    ('73','15','4724.111512','12.07.2018 16:17:56','2'),
    ('74','15','583.7018525','22.01.2020 11:28:57','3'),
    ('75','3','4190.74736','11.10.2021 18:56:51','3'),
    ('76','2','722.1709461','01.07.2019 4:41:12','1'),
    ('77','3','299.1191334','19.07.2020 1:19:10','1'),
    ('78','11','107.8322623','06.03.2018 16:37:21','1'),
    ('79','15','103.8088291','02.10.2019 20:39:13','4'),
    ('80','19','376.8723353','30.11.2018 2:14:09','1'),
    ('81','5','3339.210955','11.03.2020 13:42:15','3'),
    ('82','21','1757.720311','15.05.2022 18:27:02','3'),
    ('83','15','2117.248267','14.06.2021 15:04:04','3'),
    ('84','4','693.0056204','19.05.2018 21:00:24','4'),
    ('85','19','560.6386213','23.06.2022 9:51:04','3'),
    ('86','3','112.7389143','13.05.2020 16:14:49','1'),
    ('87','19','2056.665898','08.07.2021 20:04:59','3'),
    ('88','4','26.33159498','12.11.2020 20:49:25','4'),
    ('89','4','51.84079574','20.01.2018 8:24:58','4'),
    ('90','1','1922.238431','03.07.2021 0:35:10','3'),
    ('91','2','111.6286799','30.09.2019 10:03:09','1'),
    ('92','1','473.0651868','18.08.2021 3:03:40','4'),
    ('93','6','195.253956','01.03.2018 23:58:01','1'),
    ('94','19','337.3931984','03.06.2018 17:09:22','1'),
    ('95','5','151.1789766','17.01.2022 0:31:19','4'),
    ('96','10','668.1164699','10.11.2019 11:33:34','3'),
    ('97','22','63.4726606','02.03.2021 7:30:29','2'),
    ('98','4','204.1998377','13.08.2019 2:08:25','1'),
    ('99','10','397.2244049','27.08.2019 12:44:18','2'),
    ('100','7','87.80858044','12.02.2018 8:43:49','2'),
    ('101','4','366.9399415','07.12.2020 11:49:15','2'),
    ('102','8','121.106671','24.01.2021 9:23:07','1'),
    ('103','4','69.02927403','21.06.2021 13:59:51','2'),
    ('104','8','923.3605469','27.01.2020 5:11:01','3'),
    ('105','17','108.0576974','06.08.2020 7:00:45','4'),
    ('106','12','931.6715297','17.06.2022 23:39:00','3'),
    ('107','13','3205.923984','14.09.2020 22:39:05','3'),
    ('108','9','869.5615112','19.02.2019 20:50:36','1'),
    ('109','3','146.6378208','26.01.2020 23:45:29','4'),
    ('110','2','65.06826267','13.09.2018 10:00:51','4'),
    ('111','1','197.1651843','09.12.2018 0:21:00','2'),
    ('112','22','90.60667843','01.06.2020 0:30:27','4'),
    ('113','1','177.1174846','24.08.2019 4:27:28','1'),
    ('114','20','267.74967','27.08.2020 14:34:55','1'),
    ('115','6','8340.883875','05.02.2018 15:44:50','2'),
    ('116','22','4806.469968','28.09.2019 18:34:55','3'),
    ('117','2','569.3271189','12.05.2022 10:13:55','4'),
    ('118','21','166.128637','29.06.2019 10:58:42','1'),
    ('119','18','1498.789125','29.09.2018 19:34:36','3'),
    ('120','11','113.1340459','29.12.2019 13:29:09','4'),
    ('121','10','1616.275459','26.07.2021 10:42:04','3'),
    ('122','15','209.5200382','30.10.2021 18:18:03','4'),
    ('123','19','4892.053929','24.05.2021 0:41:15','3'),
    ('124','12','90.17545688','08.03.2018 21:42:34','4'),
    ('125','14','251.9936968','21.01.2018 17:10:52','1'),
    ('126','10','566.851236','31.10.2018 11:23:25','3'),
    ('127','18','230.1433944','10.04.2018 9:10:02','1'),
    ('128','15','911.2471474','01.10.2021 8:33:38','2'),
    ('129','20','1049.805518','02.02.2022 22:13:59','4'),
    ('130','21','2880.831699','03.11.2021 0:44:48','3'),
    ('131','9','444.5817578','17.06.2022 11:27:43','1'),
    ('132','5','339.5632524','11.07.2020 19:46:36','1'),
    ('133','4','91.08521073','12.01.2019 6:29:11','4'),
    ('134','8','77.58263539','11.06.2020 21:11:20','1'),
    ('135','8','573.7757038','20.01.2020 6:41:54','4'),
    ('136','11','367.1038187','01.02.2022 18:40:06','1'),
    ('137','9','156.2072353','31.12.2018 16:37:11','4'),
    ('138','16','188.9177131','29.10.2021 5:26:52','1'),
    ('139','7','36.71563903','26.04.2021 5:42:05','4'),
    ('140','4','800.713939','22.04.2022 6:31:04','1'),
    ('141','1','188.6195844','08.07.2022 10:55:34','1'),
    ('142','9','75.70293259','04.06.2018 6:11:03','2'),
    ('143','15','45.94301154','19.02.2020 1:00:56','4'),
    ('144','13','705.3729589','02.06.2019 20:04:37','3'),
    ('145','20','76.3183293','28.03.2021 19:19:40','2'),
    ('146','12','77.79488831','27.07.2021 5:31:40','2'),
    ('147','8','1132.536261','03.03.2018 8:08:34','4'),
    ('148','3','61.90331234','09.06.2021 22:39:15','2'),
    ('149','6','185.8210791','19.09.2018 16:13:05','2'),
    ('150','18','1094.179137','10.10.2021 19:51:20','3'),
    ('151','12','364.4972233','18.04.2019 6:20:58','4'),
    ('152','22','2490.810654','22.07.2021 17:50:13','3'),
    ('153','9','166.2330926','26.01.2019 0:39:46','1'),
    ('154','5','165.7511551','05.06.2021 16:17:14','4'),
    ('155','9','81.88440461','30.05.2019 2:10:45','4'),
    ('156','18','217.5314684','22.03.2019 15:37:12','2'),
    ('157','14','546.7429796','09.06.2019 4:48:31','4'),
    ('158','18','78.26057451','23.11.2019 9:26:30','1'),
    ('159','6','4147.687743','30.04.2020 23:27:03','3'),
    ('160','8','281.4270765','23.11.2021 14:50:47','4'),
    ('161','5','1388.574905','09.06.2019 14:49:35','3'),
    ('162','5','1514.800622','06.02.2021 5:57:50','3'),
    ('163','11','592.4021274','12.07.2018 0:42:18','3'),
    ('164','22','357.0219131','04.09.2020 0:28:45','1'),
    ('165','19','41.03134621','05.02.2021 3:03:51','4'),
    ('166','11','154.405409','26.06.2018 3:59:35','4'),
    ('167','19','202.3738732','05.02.2021 14:39:26','1'),
    ('168','22','1184.482613','24.07.2021 1:58:57','3'),
    ('169','11','659.1768958','10.12.2018 4:25:25','2'),
    ('170','6','1844.99439','07.09.2021 11:00:47','3'),
    ('171','19','422.5513469','03.12.2020 1:41:02','1'),
    ('172','12','315.2486056','25.05.2019 15:00:36','1'),
    ('173','22','246.119907','06.03.2018 19:13:43','2'),
    ('174','11','113.0063227','02.04.2019 19:55:13','2'),
    ('175','7','45.06101413','09.05.2018 19:50:57','2'),
    ('176','15','142.7622072','21.01.2018 22:07:22','1'),
    ('177','16','194.3311889','25.02.2018 3:24:50','1'),
    ('178','16','3275.017526','11.06.2021 11:58:40','3'),
    ('179','14','2152.639171','11.08.2018 7:19:19','4'),
    ('180','9','238.3507636','12.08.2022 4:49:25','1'),
    ('181','15','606.0075786','14.11.2018 3:21:25','1'),
    ('182','13','86.91019582','05.03.2021 3:17:39','1'),
    ('183','11','96.91339674','21.05.2021 4:35:40','2'),
    ('184','16','644.382663','21.12.2020 7:16:18','2'),
    ('185','14','470.3948405','23.04.2019 13:13:40','1'),
    ('186','21','2645.046722','08.11.2018 1:08:17','4'),
    ('187','9','265.8076434','16.06.2018 5:28:41','1'),
    ('188','16','961.0947596','10.12.2018 9:27:11','3'),
    ('189','16','97.48808905','08.08.2022 8:22:53','4'),
    ('190','12','129.9848583','21.06.2022 8:58:03','1'),
    ('191','9','918.808913','10.05.2018 4:48:25','3'),
    ('192','21','1563.438993','23.06.2022 22:19:46','4'),
    ('193','11','53.48955871','30.07.2020 22:37:47','4'),
    ('194','15','2596.156671','18.02.2022 0:38:17','3'),
    ('195','9','78.31668162','30.10.2020 20:38:43','2'),
    ('196','7','1442.20312','13.11.2021 14:29:22','3'),
    ('197','4','815.5255997','29.10.2021 6:07:41','3'),
    ('198','15','1830.441855','23.06.2018 6:31:41','2'),
    ('199','2','134.1199177','03.02.2019 5:42:11','4'),
    ('200','20','59.77031401','05.05.2018 3:00:43','1');

INSERT INTO checks
(transaction_id, sku_id, sku_amount, sku_summ, sku_summ_paid, sku_discount)
 VALUES
    ('1','2','3.20664673','336.3206767','190.2882909','146.0323858'),
    ('2','15','3.389733236','89.51519966','78.95744699','10.55775267'),
    ('3','15','4.155730297','294.7881466','294.7881466','0'),
    ('4','3','2.15546012','79.97275934','63.14871001','16.82404933'),
    ('5','3','1.704904501','95.33623781','95.33623781','0'),
    ('6','7','9.423756541','222.4849104','137.0933076','85.39160288'),
    ('7','2','7.721496309','809.8487556','736.9160992','72.93265637'),
    ('8','18','1.61987072','514.9179273','293.9463202','220.9716071'),
    ('9','3','5.888995811','329.3056619','184.0298363','145.2758256'),
    ('10','1','4.634789033','3970.088708','3970.088708','0'),
    ('11','2','8.508434631','316.1061682','189.1468006','126.9593676'),
    ('12','15','1.87856609','49.60868804','49.60868804','0'),
    ('13','14','2.473395552','1328.011529','725.8129454','602.1985834'),
    ('14','18','1.276278981','405.6983802','276.1243164','129.5740639'),
    ('15','14','7.622797132','4092.819874','3661.675771','431.1441038'),
    ('16','14','1.774403097','952.7096335','903.1054953','49.60413821'),
    ('17','15','6.870995769','181.4474813','128.013852','53.43362932'),
    ('18','2','6.364688703','2054.194912','2054.194912','0'),
    ('19','14','1.328031863','713.0447141','595.7353123','117.3094018'),
    ('20','14','1.44732566','777.0957463','659.2457187','117.8500276'),
    ('21','14','1.918068731','1029.846352','569.2614479','460.5849045'),
    ('22','14','4.425357557','2376.055803','1555.298305','820.7574981'),
    ('23','7','3.184221823','75.17610456','68.64472762','6.531376947'),
    ('24','3','5.931484354','220.0723485','165.9749733','54.09737526'),
    ('25','2','1.29859945','419.1212654','367.2769149','51.84435053'),
    ('26','3','4.335749158','242.4499511','215.0719192','27.3780319'),
    ('27','3','1.410474568','52.33200194','52.11088344','0.2211185056'),
    ('28','15','8.718865685','618.4757122','588.1946063','30.28110587'),
    ('29','7','2.972135937','70.16898143','39.74610282','30.42287861'),
    ('30','3','3.413345535','126.6433364','123.3493481','3.293988275'),
    ('31','2','2.613046271','274.0624596','260.1561755','13.90628417'),
    ('32','14','4.310393226','2314.329341','1701.342065','612.9872758'),
    ('33','18','1.472967311','468.220868','247.6865136','220.5343544'),
    ('34','2','8.646627873','906.8787372','679.8493088','227.0294284'),
    ('35','15','2.604769622','68.7860833','49.92595096','18.86013234'),
    ('36','18','1.920746769','610.5591841','441.0480906','169.5110934'),
    ('37','2','1.735795872','182.0543675','91.58660237','90.46776511'),
    ('38','2','2.474575561','91.93566531','52.94224444','38.99342088'),
    ('39','18','1.78071722','566.0471594','478.8994482','87.14771121'),
    ('40','18','2.788983835','886.5508571','782.5621904','103.9886667'),
    ('41','14','6.876804708','3692.282832','3692.282832','0'),
    ('42','15','3.711852777','263.3015432','254.4207133','8.880829957'),
    ('43','1','1.87597494','1606.931162','1477.880666','129.050496'),
    ('44','15','1.637911738','116.185828','91.36911775','24.81671022'),
    ('45','15','4.315087882','306.0922312','306.0922312','0'),
    ('46','18','2.937527853','933.7694265','811.3839555','122.385471'),
    ('47','14','3.680932247','1976.360173','1976.360173','0'),
    ('48','2','3.091993173','114.8740228','86.77825477','28.09576804'),
    ('49','18','4.101158743','1303.659689','1088.844673','214.815016'),
    ('50','7','1.124975455','26.55947893','15.21778165','11.34169728'),
    ('51','2','2.752085423','102.245738','76.51352619','25.73221178'),
    ('52','7','1.939071991','45.77943588','40.26154486','5.517891017'),
    ('53','14','5.989890354','3216.082215','2628.184058','587.8981566'),
    ('54','15','1.316184428','34.75745837','32.62602514','2.131433227'),
    ('55','7','1.237256109','29.21030625','23.77457267','5.435733582'),
    ('56','7','3.525971237','83.24444627','83.24444627','0'),
    ('57','18','4.332219149','1377.108233','916.5090877','460.5991449'),
    ('58','2','5.426566252','201.6083027','201.6083027','0'),
    ('59','3','1.219187422','45.23478835','45.23478835','0'),
    ('60','3','6.526750826','364.968166','350.6037781','14.36438795'),
    ('61','7','7.370541119','174.0106691','174.0106691','0'),
    ('62','15','7.575427998','200.0499457','165.8049754','34.24497023'),
    ('63','14','1.273186403','683.597179','547.3600812','136.2370978'),
    ('64','15','3.212370791','84.83145801','69.04008966','15.79136835'),
    ('65','18','4.13698223','1315.047114','1135.902002','179.1451115'),
    ('66','3','1.522754815','56.4978694','31.3768293','25.12104009'),
    ('67','14','1.953863644','1049.065299','1049.065299','0'),
    ('68','15','3.439199622','243.9607986','243.9607986','0'),
    ('69','15','1.830952216','48.35131315','48.35131315','0'),
    ('70','3','4.628588763','171.7317856','171.7317856','0'),
    ('71','7','5.092148442','120.2202312','83.19210718','37.02812402'),
    ('72','3','1.418003947','79.2930991','48.1649611','31.128138'),
    ('73','1','5.515055666','4724.111512','4724.111512','0'),
    ('74','14','1.087133308','583.7018525','573.3498983','10.35195413'),
    ('75','14','7.805185163','4190.74736','4190.74736','0'),
    ('76','2','6.885532955','722.1709461','722.1709461','0'),
    ('77','3','5.349168045','299.1191334','283.8923943','15.22673915'),
    ('78','15','1.520148638','107.8322623','55.09216869','52.74009364'),
    ('79','7','4.397013398','103.8088291','76.55371921','27.25510987'),
    ('80','15','5.31289945','376.8723353','376.8723353','0'),
    ('81','14','6.219215228','3339.210955','3288.807336','50.40361882'),
    ('82','14','3.273719773','1757.720311','903.0164198','854.7038916'),
    ('83','14','3.943333573','2117.248267','2117.248267','0'),
    ('84','18','2.180113478','693.0056204','476.3128329','216.6927875'),
    ('85','14','1.04417849','560.6386213','560.6386213','0'),
    ('86','3','2.016117761','112.7389143','112.7389143','0'),
    ('87','14','3.830500094','2056.665898','2006.485494','50.18040466'),
    ('88','7','1.115323012','26.33159498','13.99629263','12.33530235'),
    ('89','7','2.195812008','51.84079574','33.40531686','18.43547888'),
    ('90','14','3.58013156','1922.238431','1922.238431','0'),
    ('91','3','1.996263364','111.6286799','111.2001519','0.428528014'),
    ('92','18','1.488206963','473.0651868','261.0967252','211.9684616'),
    ('93','15','2.752562443','195.253956','195.253956','0'),
    ('94','3','6.033625782','337.3931984','316.9395551','20.4536433'),
    ('95','2','4.069191205','151.1789766','95.16700388','56.01197268'),
    ('96','14','1.244353885','668.1164699','526.4538016','141.6626683'),
    ('97','15','2.403562613','63.4726606','53.47320589','9.999454712'),
    ('98','3','3.651719747','204.1998377','204.1998377','0'),
    ('99','2','1.230754525','397.2244049','397.2244049','0'),
    ('100','3','2.366654532','87.80858044','54.9987926','32.80978784'),
    ('101','2','1.136921568','366.9399415','224.6524229','142.2875187'),
    ('102','3','2.16575893','121.106671','63.56733555','57.5393354'),
    ('103','3','1.860506609','69.02927403','49.55703767','19.47223635'),
    ('104','14','1.719740996','923.3605469','764.1039832','159.2565637'),
    ('105','2','2.90852235','108.0576974','73.62142462','34.43627283'),
    ('106','14','1.73522004','931.6715297','931.6715297','0'),
    ('107','14','5.970970846','3205.923984','3205.923984','0'),
    ('108','2','8.290827088','869.5615112','696.499051','173.0624602'),
    ('109','7','6.211113916','146.6378208','140.1579767','6.479844192'),
    ('110','2','1.751402267','65.06826267','39.8031026','25.26516007'),
    ('111','3','5.314080635','197.1651843','197.1651843','0'),
    ('112','7','3.837812087','90.60667843','87.88632233','2.720356095'),
    ('113','15','2.496886342','177.1174846','177.1174846','0'),
    ('114','3','4.788185771','267.74967','256.3006856','11.4489844'),
    ('115','1','9.737373633','8340.883875','7230.073114','1110.810761'),
    ('116','14','8.951956503','4806.469968','3341.068553','1465.401415'),
    ('117','18','1.791035583','569.3271189','304.3276687','264.9994502'),
    ('118','3','2.970889847','166.128637','139.8062333','26.32240369'),
    ('119','14','2.791465492','1498.789125','1317.572365','181.2167602'),
    ('120','7','4.792000062','113.1340459','76.72709932','36.40694653'),
    ('121','14','3.010281496','1616.275459','962.8249694','653.4504895'),
    ('122','7','8.874605593','209.5200382','209.5200382','0'),
    ('123','14','9.111354959','4892.053929','4892.053929','0'),
    ('124','7','3.819546907','90.17545688','83.52791071','6.647546163'),
    ('125','3','4.506420619','251.9936968','251.9936968','0'),
    ('126','14','1.055749363','566.851236','566.851236','0'),
    ('127','3','4.115670157','230.1433944','205.063252','25.0801424'),
    ('128','1','1.063814588','911.2471474','911.2471474','0'),
    ('129','18','3.302563633','1049.805518','894.284552','155.5209661'),
    ('130','14','5.365492811','2880.831699','2880.831699','0'),
    ('131','2','4.238861119','444.5817578','310.6699793','133.9117786'),
    ('132','2','3.237563041','339.5632524','339.5632524','0'),
    ('133','7','3.858081201','91.08521073','65.69924429','25.38596644'),
    ('134','15','1.093709202','77.58263539','57.81653126','19.76610412'),
    ('135','18','1.805030303','573.7757038','534.3711352','39.40456855'),
    ('136','2','3.500148345','367.1038187','367.1038187','0'),
    ('137','2','4.204533741','156.2072353','140.5287814','15.67845382'),
    ('138','3','3.378428462','188.9177131','111.573549','77.34416409'),
    ('139','7','1.555158247','36.71563903','36.71563903','0'),
    ('140','2','7.634400476','800.713939','800.713939','0'),
    ('141','15','2.659035415','188.6195844','156.5651666','32.05441782'),
    ('142','15','2.86669468','75.70293259','51.10202699','24.6009056'),
    ('143','2','1.236619686','45.94301154','45.94301154','0'),
    ('144','14','1.313743368','705.3729589','705.3729589','0'),
    ('145','15','2.889998328','76.3183293','54.10846255','22.20986675'),
    ('146','15','2.945912197','77.79488831','74.71967705','3.075211253'),
    ('147','18','3.562824737','1132.536261','1103.546828','28.98943262'),
    ('148','3','1.668444632','61.90331234','61.90331234','0'),
    ('149','15','7.036613784','185.8210791','185.8210791','0'),
    ('150','14','2.037887287','1094.179137','916.0694817','178.1096555'),
    ('151','2','9.810946794','364.4972233','297.2979582','67.19926506'),
    ('152','14','4.639086228','2490.810654','1663.740622','827.0700322'),
    ('153','3','2.972757833','166.2330926','124.3343821','41.89871045'),
    ('154','2','4.461421542','165.7511551','123.1860986','42.56505646'),
    ('155','7','3.468364178','81.88440461','64.56786833','17.31653628'),
    ('156','15','8.237412765','217.5314684','170.0823748','47.44909356'),
    ('157','18','1.71998856','546.7429796','301.1602486','245.5827309'),
    ('158','15','1.103266344','78.26057451','78.26057451','0'),
    ('159','14','7.724987467','4147.687743','4147.687743','0'),
    ('160','2','7.574998924','281.4270765','281.4270765','0'),
    ('161','14','2.586193659','1388.574905','1288.920906','99.6539995'),
    ('162','14','2.821286593','1514.800622','1514.800622','0'),
    ('163','14','1.1033374','592.4021274','456.4303853','135.971742'),
    ('164','2','3.404022498','357.0219131','313.4456418','43.57627127'),
    ('165','7','1.737957943','41.03134621','24.72518102','16.30616519'),
    ('166','2','4.156035095','154.405409','132.2912625','22.11414642'),
    ('167','3','3.619065899','202.3738732','202.3738732','0'),
    ('168','14','2.206075747','1184.482613','801.3679359','383.1146766'),
    ('169','2','2.042384448','659.1768958','461.2781331','197.8987627'),
    ('170','14','3.436266041','1844.99439','1015.442799','829.551591'),
    ('171','3','7.556514812','422.5513469','416.2447701','6.306576801'),
    ('172','2','3.005735241','315.2486056','315.2486056','0'),
    ('173','3','6.633529324','246.119907','246.119907','0'),
    ('174','3','3.045794892','113.0063227','63.1334779','49.87284482'),
    ('175','15','1.706356215','45.06101413','40.01381082','5.047203303'),
    ('176','3','2.553026374','142.7622072','83.9784606','58.78374659'),
    ('177','3','3.475238022','194.3311889','177.242167','17.08902189'),
    ('178','14','6.099656221','3275.017526','3275.017526','0'),
    ('179','18','6.771947489','2152.639171','2152.639171','0'),
    ('180','2','2.272553398','238.3507636','120.4404082','117.9103554'),
    ('181','2','5.777974281','606.0075786','407.1300676','198.877511'),
    ('182','15','1.225203042','86.91019582','64.29661503','22.61358079'),
    ('183','3','2.612051447','96.91339674','88.01821963','8.895177111'),
    ('184','2','1.996546205','644.382663','644.382663','0'),
    ('185','2','4.484975744','470.3948405','246.7543163','223.6405242'),
    ('186','18','8.321003235','2645.046722','2645.046722','0'),
    ('187','15','3.747182137','265.8076434','225.0284012','40.77924226'),
    ('188','14','1.790020231','961.0947596','859.3830233','101.7117363'),
    ('189','2','2.624026724','97.48808905','53.18368972','44.30439933'),
    ('190','15','1.832441433','129.9848583','129.9848583','0'),
    ('191','14','1.711263667','918.808913','856.9253349','61.88357815'),
    ('192','18','4.918393617','1563.438993','1563.438993','0'),
    ('193','2','1.439745438','53.48955871','44.46406869','9.025490021'),
    ('194','14','4.835291129','2596.156671','1883.915765','712.2409065'),
    ('195','3','2.110824802','78.31668162','78.31668162','0'),
    ('196','14','2.686075162','1442.20312','1442.20312','0'),
    ('197','14','1.518900512','815.5255997','479.6715245','335.8540753'),
    ('198','2','5.671415367','1830.441855','1830.441855','0'),
    ('199','7','5.680895163','134.1199177','116.0422468','18.07767085'),
    ('200','3','1.068876638','59.77031401','59.77031401','0');

INSERT INTO date_of_analysis_formation
(analysis_formation)
 VALUES
    ('21.08.2022 13:10:46');

-- drop table IF EXISTS personal_information, transactions,sku_group,product_grid,checks,stores,date_of_analysis_formation,cards CASCADE;

SELECT * FROM personal_information;

SELECT * FROM transactions;

SELECT * FROM sku_group;

SELECT * FROM product_grid;

SELECT * FROM checks;

SELECT * FROM stores;

SELECT * FROM date_of_analysis_formation;

SELECT * FROM cards;

-- export & import

CREATE OR REPLACE PROCEDURE ImportDataFromCSV(directory text) AS $$
declare
     copy_cmd text;
BEGIN
    copy_cmd:='copy personal_information(customer_name, customer_surname, customer_primary_email, customer_primary_phone ) from ''' || directory || '/personal_information.csv''  DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy cards(customer_id) from ''' || directory || '/cards.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy transactions(transaction_id, customer_card_id, transaction_summ, transaction_datetime, transaction_store_id) from ''' || directory || '/transactions.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy sku_group(group_id, group_name) from ''' || directory || '/sku_group.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy product_grid(sku_id,sku_name, group_id) from ''' || directory || '/product_grid.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy checks(transaction_id, sku_id, sku_amount, sku_summ, sku_summ_paid, sku_discount) from ''' || directory || '/checks.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy stores(transaction_store_id, sku_id, sku_purchase_price, sku_retail_price) from ''' || directory || '/stores.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy date_of_analysis_formation(analysis_formation) from ''' || directory || '/date_of_analysis_formation.csv'' DELIMITER '','' CSV HEADER';
END;
$$
    language plpgsql;

call ImportDataFromCSV('/Users/florentq/Projects/SQL/SQL3_RetailAnalitycs_v1.0-1/src/csv');



CREATE  OR REPLACE PROCEDURE ExportDataToCSV(directory text) AS $$
declare
     copy_cmd text;
BEGIN
    copy_cmd:='copy personal_information(customer_name, customer_surname, customer_primary_email, customer_primary_phone) from ''' || directory || '/personal_information.csv''  DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy cards(customer_id) to ''' || directory || '/cards.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy transactions(transaction_id, customer_card_id, transaction_summ, transaction_datetime, transaction_store_id) to ''' || directory || '/transactions.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy sku_group(group_id, group_name) to ''' || directory || '/sku_group.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy product_grid(sku_id,sku_name, group_id) to ''' || directory || '/product_grid.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy checks(transaction_id, sku_id, sku_amount, sku_summ, sku_summ_paid, sku_discount) to ''' || directory || '/checks.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy stores(transaction_store_id, sku_id, sku_purchase_price, sku_retail_price) to ''' || directory || '/stores.csv'' DELIMITER '','' CSV HEADER';
    EXECUTE (copy_cmd);
    copy_cmd:='copy date_of_analysis_formation(analysis_formation) to ''' || directory || '/date_of_analysis_formation.csv'' DELIMITER '','' CSV HEADER';
END;
$$
    language plpgsql;

call ExportDataToCSV('/Users/florentq/Projects/SQL/SQL3_RetailAnalitycs_v1.0-1/src/csv');




CREATE OR REPLACE PROCEDURE ImportDataFromTSV(directory text) AS $$
BEGIN
    EXECUTE 'COPY personal_information(customer_id,customer_name, customer_surname, customer_primary_email, customer_primary_phone) FROM ''' || directory || '/Personal_Data_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY cards(customer_card_id,customer_id) FROM ''' || directory || '/Cards_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE'COPY transactions(transaction_id, customer_card_id, transaction_summ, transaction_datetime, transaction_store_id) FROM ''' || directory || '/Transactions_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY sku_group(group_id, group_name) FROM ''' || directory || '/Groups_SKU_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY product_grid(sku_id,sku_name, group_id) FROM ''' || directory || '/SKU_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY checks(transaction_id, sku_id, sku_amount, sku_summ, sku_summ_paid, sku_discount) FROM ''' || directory || '/Checks_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY stores(transaction_store_id, sku_id, sku_purchase_price, sku_retail_price) FROM ''' || directory || '/Stores_Mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY date_of_analysis_formation(analysis_formation) FROM ''' || directory || '/Date_Of_Analysis_Formation.tsv'' WITH DELIMITER E''\t''';
END;
$$
    LANGUAGE plpgsql;

call ImportDataFromTSV('/Users/florentq/Projects/SQL/SQL3_RetailAnalitycs_v1.0-1/datasets');


CREATE OR REPLACE PROCEDURE ExportDataFromTSV(directory text) AS $$
BEGIN
    EXECUTE 'COPY personal_information(customer_id,customer_name, customer_surname, customer_primary_email, customer_primary_phone) TO ''' || directory || '/Personal_Data_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY cards(customer_card_id,customer_id) TO ''' || directory || '/Cards_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE'COPY transactions(transaction_id, customer_card_id, transaction_summ, transaction_datetime, transaction_store_id) TO ''' || directory || '/Transactions_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY sku_group(group_id, group_name) TO ''' || directory || '/Groups_SKU_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY product_grid(sku_id,sku_name, group_id) TO ''' || directory || '/SKU_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY checks(transaction_id, sku_id, sku_amount, sku_summ, sku_summ_paid, sku_discount) TO ''' || directory || '/Checks_mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY stores(transaction_store_id, sku_id, sku_purchase_price, sku_retail_price) TO ''' || directory || '/Stores_Mini.tsv'' WITH DELIMITER E''\t''';
    EXECUTE 'COPY date_of_analysis_formation(analysis_formation) TO ''' || directory || '/Date_Of_Analysis_Formation.tsv'' WITH DELIMITER E''\t''';
END;
$$
    LANGUAGE plpgsql;

call ExportDataFromTSV('/Users/florentq/Projects/SQL/SQL3_RetailAnalitycs_v1.0-1/datasets');